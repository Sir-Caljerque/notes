# Run code without servers
 AWS Lambda is a *serverless* compute service

![[Pasted image 20240818193313.png]]

As you saw in the earlier sections of this module, AWS offers many compute options. For example, **Amazon EC2**provides virtual machines.As another example, **Amazon ECS** and **Amazon EKS**are container-based compute services.

However, there is another approach to compute that does not require you to provision or manage servers. This third approach is often referred to as **serverless computing**. 

**AWS Lambda** is an event-driven, serverless compute service. Lambda enables you to run code without provisioning or managing servers. 

You create a**Lambda function**, which is the AWS resource that contains the code that you upload. You then set the Lambda function to be triggered, either on a scheduled basis or in response to an event. Your code only runs when it is triggered.

You **pay only for the compute time you consume** — you are not charged when your code is not running.

# Benefits of Lambda

  it supports multiple programming languages
  Completely automated administration
  Built-in fault tolerance
󰦾  It supports the orchestration of multiple functions
󰋟 Pay-per-use pricing

With Lambda, there are no new languages, tools, or frameworks to learn. Lambda **supports multiple programming languages**, including Java, Go, PowerShell, Node.js, C#, Python, and Ruby. Your code can use any library, either native or third-party. 

Lambda **completely automates the administration**. It manages all the infrastructure to run your code on highly available, fault-tolerant infrastructure, which enables you to focus on building differentiated backend services. Lambda seamlessly deploys your code; does all the administration, maintenance, and security patches; and provides built-in logging and monitoring through Amazon CloudWatch.

Lambda provides **built-in fault tolerance**. It maintains compute capacity across multiple Availability Zones in each Region to help protect your code against individual machine failures or data center failures. There are no maintenance windows or scheduled downtimes.

You can **orchestrate multiple Lambda functions** for complex or long-running tasks by building workflows with AWS Step Functions. Use Step Functions to define workflows. These workflows trigger a collection of Lambda functions by using sequential, parallel, branching, and error-handling steps. With Step Functions and Lambda, you can build stateful, long-running processes for applications and backends.

With Lambda, you **pay only for the requests that are served and the compute time that is required to run your code**. Billing is metered in increments of 100 milliseconds, which make it cost-effective and easy to scale automatically from a few requests per day to thousands of requests per second.

# AWS Lambda event sources

![[Pasted image 20240818194435.png]]

An **event source** is an AWS service or a developer-created application that produces events that trigger an AWS Lambda function to run. 

Some services publish events to Lambda by invoking the Lambda function directly. These services that invoke Lambda functions ***asynchronously* include, but are not limited to, Amazon S3, Amazon Simple Notification Service (Amazon SNS), and Amazon CloudWatch Events. 

Lambda can also poll resources in other services that do not publish events to Lambda. For example, Lambda can pull records from an **Amazon Simple Queue Service (Amazon SQS)** queue and run a Lambda function for each fetched message. Lambda can similarly read events from **Amazon DynamoDB**. 

Some services, such as Elastic Load Balancing (Application Load Balancer) and Amazon API Gateway can **invoke your Lambda function directly**.

You can invoke Lambda functions directly with the Lambda console, the Lambda API, the AWS software development kit (SDK), the AWS CLI, and AWS toolkits. The direct invocation approach can be useful, such as when you are developing a mobile app and want the app to call Lambda functions. See the Using Lambda with Other Services documentation at https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.htmlfor further details about all supported services.

**AWS Lambda automatically monitors Lambda functions by using Amazon CloudWatch**. To help you troubleshoot failures in a function, Lambda logs all requests that are handled by your function. It also **automatically stores logs that are generated by your code** through Amazon CloudWatch Logs.

# AWS Lambda configuration

![[Pasted image 20240818195057.png]]

Remeber that a Lambda function is the custom code that you write to process events, and the Lambda runs the Lambda function on your behalddd.

When you use the AWS Managements Console to create a *Lambda function*, you first give the function a name. Then you specify:
- The **runtime environment** the function will use (for example, a version of Python or Node.js)
- An **execution role** (to grant IAM permission to the function so that it can interact with other AWS services as necessary)

Next, after you click **Create Function**, you configure the function. Configurations include:
- Add a **trigger** (specify one of the available **event sources** from the previous slide)
- Add your **function code** (use the provided code editor or upload a file that contains your code)
- Specify the **memory** in MB to allocate to your function (128 MB to 10,240 MB)
- Optionally specify environment variables, description, timeout, the specific virtual private cloud (VPC) to run the function in, tags you would like to use, and other settings. For more information, see Configuring functions in the AWS Lambda console https://docs.aws.amazon.com/lambda/latest/dg/configuration-console.html in the AWS Documentation.

All of the above settings end up in a **Lambda deployment package** which is a ZIP archive that contains your function code and dependencies.When you use the Lambda console to author your function, the console manages the package for you. However, you need to create a deployment package if you use the Lambda API to manage functions.

# Schedule-based Lambda function example:
## Start and stop EC2 instances

![[Pasted image 20240818195916.png]]

Consider an example use case for a schedule-based Lambda function. Say that you are in a situation where you want to reduce your Amazon EC2 usage. You decide that you want to stop instances at a predefined time (for example, at night when no one is accessing them) and then you want to start the instances back up in the morning (before the workday starts).

In this situation, you could configure *AWS Lambda* and *Amazon CloudWatch* Events to help you accomplish these actions automatically. 

Here is what happens at each step in the example:
1. A CloudWatch event is scheduled to run a Lambda function to stop your EC2 instances at (for example) 22:00 GMT.
2. The Lambda function is triggered and runs with the IAM role that gives the function permission to stop the EC2 instances. 
3. The EC2 instances enter the stopped state.
4. Later, at (for example) 05:00 AM GMT, a CloudWatch event is scheduled to run a Lambda function to start the EC2 instances.
5. The Lambda function is triggered and runs with the IAM role that gives it permission to start the EC2 instances.
6. The EC2 instances enter the running state.

## Create thumbnail images

![[Pasted image 20240818200018.png]]

Now, consider an example use case for an event-based Lambda function. Suppose that you want to create a thumbnail for each image (.jpg or .png object) that is uploaded to an S3 bucket. 

To build a solution, you can create a Lambda function that Amazon S3 invokes when objects are uploaded. Then, the Lambda function reads the image object from the source bucket and creates a thumbnail image in a target bucket. Here’s how it works:
1. A user uploads an object to the source bucket in Amazon S3 (object-created event).
2. Amazon S3 detects the object-created event.
3. Amazon S3 publishes theobject-created event to Lambda by invoking the Lambda function and passing event data.
4. Lambda runs the Lambda function by assuming the execution role that you specified when you created the Lambda function.
5. Based the event data that the Lambda function receives, it knows the source bucket name and object key name. The Lambda function reads the object and creates a thumbnail by using graphics libraries, and saves the thumbnail to the target bucket.

# AWS Lambda quotas
- Soft limits per Region:
    - Concurrent executions = 1,000
    - Function and layer storage = 75GB
- Hard limits for individual functions:
    - Maximum function memory allocaiton = 10,240MB
    - Function timeout = 15 minutes
    - Deployment package size = 250MB Unzipped, including layers
    - Container image code package size = 10GB

Additional limits also exist. Details are in the AWS Lambda quotas documentation at https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html

AWS Lambda does have some quotas that you should know about when you create and deploy Lambda functions. 

AWS Lambda limits the amount of compute and storage resources that you can use to run and store functions. For example, as of this writing, the maximum memory allocation for a single Lambda function is 10,240 MB. It also has limits of 1,000 concurrent executions in a Region. Lambda functions can be configured to run up to 15 minutes per run. You can set the timeout to any value between 1 second and 15 minutes. If you are troubleshooting a Lambda deployment, keep these limits in mind. 

There are limits on the deployment package size of a function (250 MB). A layeris a ZIP archive that contains libraries, a custom runtime, or other dependencies. With layers, you can use libraries in your function without needing to include them in your deploymentpackage. Using layers can help avoid reaching the size limit for deployment package. Layers are also a good way to share code and data between Lambda functions.

For larger workloads that rely on sizable dependencies, such as machine learning or data intensive workloads, you can deploy your Lambda function to a container image up to 10 GB in size.

Limits are either soft or hard. Soft limits on an account can potentially be relaxed by submitting a support ticket and providing justification for the request. **Hard limits** cannot be increased.

For the details on current AWS Lambda quotas, refer to the AWS Lambda quotas documentation at https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html.

# Key takeaways
Some key takeaways from this section of the module include:
- Serverless computing enables you to build and run applications and services without provisioning or managing servers. 
- AWS Lambda is a serverless compute service that provides built-in fault tolerance and automatic scaling.
- An event source is an AWS service or developer-created application that triggers a Lambda function to run. 
- The maximum memory allocation for a single Lambda function is 10,240 MB. 
- The maximum run time for a Lambda function is 15 minutes.
